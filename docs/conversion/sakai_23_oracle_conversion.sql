-- SAK-46436
ALTER TABLE TASKS ADD TASK_OWNER VARCHAR2(99 CHAR);

CREATE TABLE TASKS_ASSIGNED
(
   ID              NUMBER(19,0) NOT NULL,
   TASK_ID         NUMBER(19,0) NOT NULL,
   ASSIGNATION_TYPE   VARCHAR2(5) NOT NULL,
   OBJECT_ID       VARCHAR2(99 CHAR),
   PRIMARY KEY(ID),
   CONSTRAINT FK_TASKS_ASSIGNED_TASKS FOREIGN KEY(TASK_ID) REFERENCES TASKS (ID)
);

CREATE SEQUENCE TASKS_ASSIGNED_S MINVALUE 1 MAXVALUE 9999999999999999999999999999 INCREMENT BY 1 START WITH 1 CACHE 20;
CREATE INDEX IDX_TASKS_ASSIGNED ON TASKS_ASSIGNED (TASK_ID);

-- SAK-46178
RENAME COLUMN rbc_tool_item_rbc_assoc.ownerId TO siteId;
DROP INDEX rbc_tool_item_owner;
CREATE INDEX rbc_tool_item_active ON rbc_tool_item_rbc_assoc(toolId, itemId, active);
ALTER TABLE rbc_criterion ADD order_index NUMBER(1,0) NULL;
ALTER TABLE rbc_rating ADD order_index NUMBER(1,0) NULL;
UPDATE rbc_rating r, rbc_criterion_ratings cr SET r.criterion_id = cr.rbc_criterion_id, r.order_index = cr.order_index WHERE cr.ratings_id = r.id;
UPDATE rbc_criterion c, rbc_rubric_criterions rc SET c.rubric_id = rc.rbc_rubric_id, c.order_index = rc.order_index WHERE rc.criterions_id = c.id;
-- END SAK-46178

-- SAK-46257
ALTER TABLE CONV_POSTS ADD DEPTH NUMBER(2, 0);
ALTER TABLE CONV_TOPIC_STATUS ADD POSTED NUMBER(1,0);
ALTER TABLE CONV_TOPICS ADD DUE_DATE TIMESTAMP DEFAULT NULL;
ALTER TABLE CONV_TOPICS ADD HIDE_DATE TIMESTAMP DEFAULT NULL;
ALTER TABLE CONV_TOPICS ADD LOCK_DATE TIMESTAMP DEFAULT NULL;
ALTER TABLE CONV_TOPICS ADD SHOW_DATE TIMESTAMP DEFAULT NULL;
ALTER TABLE CONV_POSTS ADD HOW_ACTIVE NUMBER(2, 0);
ALTER TABLE CONV_COMMENTS ADD TOPIC_ID VARCHAR2(36) NOT NULL;
ALTER TABLE CONV_POSTS ADD NUMBER_OF_THREAD_REACTIONS NUMBER(8, 0);
ALTER TABLE CONV_POSTS ADD NUMBER_OF_THREAD_REPLIES NUMBER(8, 0);
ALTER TABLE CONV_POSTS ADD PARENT_THREAD_ID VARCHAR2(255) DEFAULT NULL;
ALTER TABLE CONV_TOPICS ADD MUST_POST_BEFORE_VIEWING NUMBER(1,0);
CREATE INDEX conv_topics_site_creator_idx ON CONV_TOPICS(SITE_ID, CREATOR);
CREATE INDEX conv_posts_parent_thread_idx ON CONV_POSTS(PARENT_THREAD_ID);
CREATE INDEX conv_posts_topic_creator_idx ON CONV_POSTS(TOPIC_ID, CREATOR);
CREATE INDEX conv_comments_topic_idx ON CONV_COMMENTS(TOPIC_ID);
-- END SAK-46257
