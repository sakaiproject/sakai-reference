-- SAK-38427

ALTER TABLE MFR_TOPIC_T ADD ALLOW_EMAIL_NOTIFICATIONS NUMBER(1,0) DEFAULT 1 NOT NULL;
ALTER TABLE MFR_TOPIC_T ADD INCLUDE_CONTENTS_IN_EMAILS NUMBER(1,0) DEFAULT 1 NOT NULL;

-- END SAK-38427

-- SAK-33969
ALTER TABLE MFR_OPEN_FORUM_T ADD RESTRICT_PERMS_FOR_GROUPS NUMBER(1) DEFAULT '0';
ALTER TABLE MFR_TOPIC_T ADD RESTRICT_PERMS_FOR_GROUPS NUMBER(1) DEFAULT '0';
-- SAK-33969

-- SAK-39967

CREATE INDEX contentreview_provider_id_idx on CONTENTREVIEW_ITEM (providerId, externalId);

-- End SAK-39967

-- SAK-40182
DECLARE
    seq_start INTEGER;
BEGIN
   SELECT NVL(MAX(PUBLISHEDSECTIONMETADATAID),0) + 1
   INTO   seq_start   FROM SAM_PUBLISHEDSECTIONMETADATA_T;
   EXECUTE IMMEDIATE 'CREATE SEQUENCE SAM_PUBSECTIONMETADATA_ID_S START WITH '||seq_start||' INCREMENT BY 1 NOMAXVALUE';
END;
-- End SAK-40182

-- SAK-41021
ALTER TABLE SIGNUP_TS_ATTENDEES ADD INSCRIPTION_TIME TIMESTAMP;

ALTER TABLE SIGNUP_TS_WAITINGLIST ADD INSCRIPTION_TIME TIMESTAMP;

-- END SAK-41021

-- SAK-40967
INSERT INTO SAKAI_REALM_FUNCTION VALUES (SAKAI_REALM_FUNCTION_SEQ.NEXTVAL, 'rubrics.evaluee');
INSERT INTO SAKAI_REALM_FUNCTION VALUES (SAKAI_REALM_FUNCTION_SEQ.NEXTVAL, 'rubrics.evaluator');
INSERT INTO SAKAI_REALM_FUNCTION VALUES (SAKAI_REALM_FUNCTION_SEQ.NEXTVAL, 'rubrics.associator');
INSERT INTO SAKAI_REALM_FUNCTION VALUES (SAKAI_REALM_FUNCTION_SEQ.NEXTVAL, 'rubrics.editor');

INSERT INTO SAKAI_REALM_RL_FN VALUES((select REALM_KEY from SAKAI_REALM where REALM_ID = '!site.user'), (select ROLE_KEY from SAKAI_REALM_ROLE where ROLE_NAME = 'access'), (select FUNCTION_KEY from SAKAI_REALM_FUNCTION where FUNCTION_NAME = 'rubrics.evaluee'));
INSERT INTO SAKAI_REALM_RL_FN VALUES((select REALM_KEY from SAKAI_REALM where REALM_ID = '!site.user'), (select ROLE_KEY from SAKAI_REALM_ROLE where ROLE_NAME = 'maintain'), (select FUNCTION_KEY from SAKAI_REALM_FUNCTION where FUNCTION_NAME = 'rubrics.associator'));
INSERT INTO SAKAI_REALM_RL_FN VALUES((select REALM_KEY from SAKAI_REALM where REALM_ID = '!site.user'), (select ROLE_KEY from SAKAI_REALM_ROLE where ROLE_NAME = 'maintain'), (select FUNCTION_KEY from SAKAI_REALM_FUNCTION where FUNCTION_NAME = 'rubrics.editor'));
INSERT INTO SAKAI_REALM_RL_FN VALUES((select REALM_KEY from SAKAI_REALM where REALM_ID = '!site.user'), (select ROLE_KEY from SAKAI_REALM_ROLE where ROLE_NAME = 'maintain'), (select FUNCTION_KEY from SAKAI_REALM_FUNCTION where FUNCTION_NAME = 'rubrics.evaluator'));
INSERT INTO SAKAI_REALM_RL_FN VALUES((select REALM_KEY from SAKAI_REALM where REALM_ID = '!site.user'), (select ROLE_KEY from SAKAI_REALM_ROLE where ROLE_NAME = 'maintain'), (select FUNCTION_KEY from SAKAI_REALM_FUNCTION where FUNCTION_NAME = 'rubrics.evaluee'));

INSERT INTO SAKAI_REALM_RL_FN VALUES((select REALM_KEY from SAKAI_REALM where REALM_ID = '!site.template'), (select ROLE_KEY from SAKAI_REALM_ROLE where ROLE_NAME = 'access'), (select FUNCTION_KEY from SAKAI_REALM_FUNCTION where FUNCTION_NAME = 'rubrics.evaluee'));
INSERT INTO SAKAI_REALM_RL_FN VALUES((select REALM_KEY from SAKAI_REALM where REALM_ID = '!site.template'), (select ROLE_KEY from SAKAI_REALM_ROLE where ROLE_NAME = 'maintain'), (select FUNCTION_KEY from SAKAI_REALM_FUNCTION where FUNCTION_NAME = 'rubrics.evaluator'));
INSERT INTO SAKAI_REALM_RL_FN VALUES((select REALM_KEY from SAKAI_REALM where REALM_ID = '!site.template'), (select ROLE_KEY from SAKAI_REALM_ROLE where ROLE_NAME = 'maintain'), (select FUNCTION_KEY from SAKAI_REALM_FUNCTION where FUNCTION_NAME = 'rubrics.associator'));
INSERT INTO SAKAI_REALM_RL_FN VALUES((select REALM_KEY from SAKAI_REALM where REALM_ID = '!site.template'), (select ROLE_KEY from SAKAI_REALM_ROLE where ROLE_NAME = 'maintain'), (select FUNCTION_KEY from SAKAI_REALM_FUNCTION where FUNCTION_NAME = 'rubrics.editor'));
INSERT INTO SAKAI_REALM_RL_FN VALUES((select REALM_KEY from SAKAI_REALM where REALM_ID = '!site.template'), (select ROLE_KEY from SAKAI_REALM_ROLE where ROLE_NAME = 'maintain'), (select FUNCTION_KEY from SAKAI_REALM_FUNCTION where FUNCTION_NAME = 'rubrics.evaluee'));

INSERT INTO SAKAI_REALM_RL_FN VALUES((select REALM_KEY from SAKAI_REALM where REALM_ID = '!site.template.course'), (select ROLE_KEY from SAKAI_REALM_ROLE where ROLE_NAME = 'Student'), (select FUNCTION_KEY from SAKAI_REALM_FUNCTION where FUNCTION_NAME = 'rubrics.evaluee'));
INSERT INTO SAKAI_REALM_RL_FN VALUES((select REALM_KEY from SAKAI_REALM where REALM_ID = '!site.template.course'), (select ROLE_KEY from SAKAI_REALM_ROLE where ROLE_NAME = 'Instructor'), (select FUNCTION_KEY from SAKAI_REALM_FUNCTION where FUNCTION_NAME = 'rubrics.associator'));
INSERT INTO SAKAI_REALM_RL_FN VALUES((select REALM_KEY from SAKAI_REALM where REALM_ID = '!site.template.course'), (select ROLE_KEY from SAKAI_REALM_ROLE where ROLE_NAME = 'Instructor'), (select FUNCTION_KEY from SAKAI_REALM_FUNCTION where FUNCTION_NAME = 'rubrics.editor'));
INSERT INTO SAKAI_REALM_RL_FN VALUES((select REALM_KEY from SAKAI_REALM where REALM_ID = '!site.template.course'), (select ROLE_KEY from SAKAI_REALM_ROLE where ROLE_NAME = 'Instructor'), (select FUNCTION_KEY from SAKAI_REALM_FUNCTION where FUNCTION_NAME = 'rubrics.evaluator'));
INSERT INTO SAKAI_REALM_RL_FN VALUES((select REALM_KEY from SAKAI_REALM where REALM_ID = '!site.template.course'), (select ROLE_KEY from SAKAI_REALM_ROLE where ROLE_NAME = 'Instructor'), (select FUNCTION_KEY from SAKAI_REALM_FUNCTION where FUNCTION_NAME = 'rubrics.evaluee'));
INSERT INTO SAKAI_REALM_RL_FN VALUES((select REALM_KEY from SAKAI_REALM where REALM_ID = '!site.template.course'), (select ROLE_KEY from SAKAI_REALM_ROLE where ROLE_NAME = 'Teaching Assistant'), (select FUNCTION_KEY from SAKAI_REALM_FUNCTION where FUNCTION_NAME = 'rubrics.evaluator'));
INSERT INTO SAKAI_REALM_RL_FN VALUES((select REALM_KEY from SAKAI_REALM where REALM_ID = '!site.template.course'), (select ROLE_KEY from SAKAI_REALM_ROLE where ROLE_NAME = 'Teaching Assistant'), (select FUNCTION_KEY from SAKAI_REALM_FUNCTION where FUNCTION_NAME = 'rubrics.evaluee'));

-- End SAK-40967

-- SAK-40721
ALTER TABLE BULLHORN_ALERTS ADD DEFERRED NUMBER(1) DEFAULT 0 NOT NULL;
-- END SAK-40721

-- SAK-41017

UPDATE SAKAI_SITE_PAGE SET layout = '0' WHERE page_id = '!error-100';
UPDATE SAKAI_SITE_PAGE SET layout = '0' WHERE page_id = '!urlError-100';

-- End of SAK-41017

-- SAK-33855 add settings for display of stats
ALTER TABLE gb_gradebook_t ADD assignment_stats_displayed NUMBER(1,0) DEFAULT '1' NOT NULL;
ALTER TABLE gb_gradebook_t ADD course_grade_stats_displayed NUMBER(1,0) DEFAULT '1' NOT NULL;
-- end SAK-33855

-- SAK-41225
DELETE FROM EMAIL_TEMPLATE_ITEM WHERE template_key = 'polls.notifyDeletedOption' AND template_locale='default';
-- End of SAK-41225

ALTER TABLE lti_tools
  ADD (allowfa_icon NUMBER(1) DEFAULT 0)
  ADD (allowlineitems NUMBER(1) DEFAULT 0)
  ADD (rolemap CLOB)
  ADD (lti13_client_id varchar2(1024) DEFAULT NULL)
  ADD (lti13_tool_public CLOB)
  ADD (lti13_tool_keyset CLOB)
  ADD (lti13_tool_kid varchar2(1024) DEFAULT NULL)
  ADD (lti13_tool_private CLOB)
  ADD (lti13_platform_public CLOB)
  ADD (lti13_platform_private CLOB)
  ADD (lti13_oidc_endpoint varchar2(1024) DEFAULT NULL)
  ADD (lti13_oidc_redirect varchar2(1024) DEFAULT NULL)
  ADD (lti11_launch_type NUMBER(1) DEFAULT 0);

ALTER TABLE lti_deploy ADD allowlineitems NUMBER(1) DEFAULT '0';

CREATE TABLE RBC_CRITERION (
  ID NUMBER(19) NOT NULL ,
  DESCRIPTION CLOB ,
  CREATED RAW(255) ,
  CREATORID VARCHAR2(255 CHAR) ,
  MODIFIED RAW(255) ,
  OWNERID VARCHAR2(255 CHAR) ,
  OWNERTYPE VARCHAR2(255 CHAR) ,
  SHARED NUMBER(1) NOT NULL ,
  TITLE VARCHAR2(255 CHAR) ,
  RUBRIC_ID NUMBER(19) ,
  CONSTRAINT ID PRIMARY KEY (ID)
);

CREATE TABLE RBC_CRITERION_OUTCOME (
  ID NUMBER(19) NOT NULL ,
  COMMENTS VARCHAR2(255 CHAR) ,
  CRITERION_ID NUMBER(19) ,
  POINTS NUMBER(10) ,
  POINTSADJUSTED NUMBER(1) NOT NULL ,
  SELECTED_RATING_ID NUMBER(19) ,
  CONSTRAINT ID PRIMARY KEY (ID)
);

CREATE TABLE RBC_CRITERION_RATINGS (
  RBC_CRITERION_ID NUMBER(19) NOT NULL ,
  RATINGS_ID NUMBER(19) NOT NULL ,
  ORDER_INDEX NUMBER(10) NOT NULL ,
  CONSTRAINT ID PRIMARY KEY (RBC_CRITERION_ID, ORDER_INDEX) ,
  CONSTRAINT RATINGS_ID UNIQUE (RATINGS_ID)
);

CREATE TABLE RBC_EVAL_CRITERION_OUTCOMES (
  RBC_EVALUATION_ID NUMBER(19) NOT NULL ,
  CRITERIONOUTCOMES_ID NUMBER(19) NOT NULL ,
  CONSTRAINT CRITERIONOUTCOMES_ID UNIQUE (CRITERIONOUTCOMES_ID)
);

CREATE TABLE RBC_EVALUATION (
  ID NUMBER(19) NOT NULL ,
  EVALUATED_ITEM_ID VARCHAR2(255 CHAR) ,
  EVALUATED_ITEM_OWNER_ID VARCHAR2(255 CHAR) ,
  EVALUATOR_ID VARCHAR2(255 CHAR) ,
  CREATED RAW(255) ,
  CREATORID VARCHAR2(255 CHAR) ,
  MODIFIED RAW(255) ,
  OWNERID VARCHAR2(255 CHAR) ,
  OWNERTYPE VARCHAR2(255 CHAR) ,
  SHARED NUMBER(1) NOT NULL ,
  OVERALLCOMMENT VARCHAR2(255 CHAR) ,
  ASSOCIATION_ID NUMBER(19) NOT NULL ,
  CONSTRAINT ID PRIMARY KEY (ID) ,
  CONSTRAINT UK_DN0JUE890JN9P7VS6TVNSF2GF UNIQUE (ASSOCIATION_ID, EVALUATED_ITEM_ID, EVALUATOR_ID)
);

CREATE TABLE RBC_RATING (
  ID NUMBER(19) NOT NULL ,
  DESCRIPTION CLOB ,
  CREATED RAW(255) ,
  CREATORID VARCHAR2(255 CHAR) ,
  MODIFIED RAW(255) ,
  OWNERID VARCHAR2(255 CHAR) ,
  OWNERTYPE VARCHAR2(255 CHAR) ,
  SHARED NUMBER(1) NOT NULL ,
  POINTS NUMBER(10) ,
  TITLE VARCHAR2(255 CHAR) ,
  CRITERION_ID NUMBER(19) ,
  CONSTRAINT ID PRIMARY KEY (ID)
);

CREATE TABLE RBC_RUBRIC (
  ID NUMBER(19) NOT NULL ,
  DESCRIPTION VARCHAR2(255 CHAR) ,
  CREATED RAW(255) ,
  CREATORID VARCHAR2(255 CHAR) ,
  MODIFIED RAW(255) ,
  OWNERID VARCHAR2(255 CHAR) ,
  OWNERTYPE VARCHAR2(255 CHAR) ,
  SHARED NUMBER(1) NOT NULL ,
  TITLE VARCHAR2(255 CHAR) ,
  CONSTRAINT ID PRIMARY KEY (ID)
);

CREATE TABLE RBC_RUBRIC_CRITERIONS (
  RBC_RUBRIC_ID NUMBER(19) NOT NULL ,
  CRITERIONS_ID NUMBER(19) NOT NULL ,
  ORDER_INDEX NUMBER(10) NOT NULL ,
  CONSTRAINT ID PRIMARY KEY (RBC_RUBRIC_ID, ORDER_INDEX)
);

CREATE TABLE RBC_TOOL_ITEM_RBC_ASSOC (
  ID NUMBER(19) NOT NULL ,
  ITEMID VARCHAR2(255 CHAR) ,
  CREATED RAW(255) ,
  CREATORID VARCHAR2(255 CHAR) ,
  MODIFIED RAW(255) ,
  OWNERID VARCHAR2(255 CHAR) ,
  OWNERTYPE VARCHAR2(255 CHAR) ,
  SHARED NUMBER(1) NOT NULL ,
  RUBRIC_ID NUMBER(19) ,
  TOOLID VARCHAR2(255 CHAR) ,
  CONSTRAINT ID PRIMARY KEY (ID)
);

CREATE TABLE RBC_TOOL_ITEM_RBC_ASSOC_CONF (
  ASSOCIATION_ID NUMBER(19) NOT NULL ,
  PARAMETERS NUMBER(1) ,
  PARAMETER_LABEL VARCHAR2(255 CHAR) NOT NULL 
  CONSTRAINT ID PRIMARY KEY (ASSOCIATION_ID, PARAMETER_LABEL)
);

ALTER TABLE RBC_CRITERION ADD CONSTRAINT FK_52CA0OI01I6AYKOCYB9840O37 FOREIGN KEY (RUBRIC_ID) REFERENCES RBC_RUBRIC (ID) ;
ALTER TABLE RBC_CRITERION_OUTCOME ADD CONSTRAINT FK_H43853LSEE9XSAY4QLIC80PKV FOREIGN KEY (CRITERION_ID) REFERENCES RBC_CRITERION (ID) ;
ALTER TABLE RBC_CRITERION_RATINGS ADD CONSTRAINT FK_FUNJJD0XKRMM5X300R7I4LA83 FOREIGN KEY (RATINGS_ID) REFERENCES RBC_RATING (ID) ;
ALTER TABLE RBC_CRITERION_RATINGS ADD CONSTRAINT FK_H4U89CJ06CHITNT3VCDSU5T7M FOREIGN KEY (RBC_CRITERION_ID) REFERENCES RBC_CRITERION (ID) ;
ALTER TABLE RBC_EVAL_CRITERION_OUTCOMES ADD CONSTRAINT FK_CC847HGHHH56XMWCAXMEVYHRN FOREIGN KEY (RBC_EVALUATION_ID) REFERENCES RBC_EVALUATION (ID) ;
ALTER TABLE RBC_EVAL_CRITERION_OUTCOMES ADD CONSTRAINT FK_F8XY8709BLLEWHBVE9IAS2VK4 FOREIGN KEY (CRITERIONOUTCOMES_ID) REFERENCES RBC_CRITERION_OUTCOME (ID) ;
ALTER TABLE RBC_EVALUATION ADD CONSTRAINT FK_FAOHMO8EWMYBGP67W10G53DTM FOREIGN KEY (ASSOCIATION_ID) REFERENCES RBC_TOOL_ITEM_RBC_ASSOC (ID) ;
ALTER TABLE RBC_RATING ADD CONSTRAINT FK_N44RJF77GSCR2KQKAMFBPKC7T FOREIGN KEY (CRITERION_ID) REFERENCES RBC_CRITERION (ID) ;
ALTER TABLE RBC_RUBRIC_CRITERIONS ADD CONSTRAINT FK_6JO83T1DDEBDBT9296Y1XFTKN FOREIGN KEY (RBC_RUBRIC_ID) REFERENCES RBC_RUBRIC (ID) ;
ALTER TABLE RBC_RUBRIC_CRITERIONS ADD CONSTRAINT FK_SOAU1PPW2WAKBX8HEMAAANUBI FOREIGN KEY (CRITERIONS_ID) REFERENCES RBC_CRITERION (ID) ;
ALTER TABLE RBC_TOOL_ITEM_RBC_ASSOC ADD CONSTRAINT FK_6DWEJ9J9VX5VIUKV8W86CHBBC FOREIGN KEY (RUBRIC_ID) REFERENCES RBC_RUBRIC (ID) ;
ALTER TABLE RBC_TOOL_ITEM_RBC_ASSOC_CONF ADD CONSTRAINT FK_RDPID6JL4CSVFV6LA80PPU6P9 FOREIGN KEY (ASSOCIATION_ID) REFERENCES RBC_TOOL_ITEM_RBC_ASSOC (ID) ;
